<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>
      Elixir Websocket
    </title>
  </head>
  <body>
    <main id="main"></main>
    <br>
    <form>
      <div style="display: inline-block">
        <label for="subject">Subject</label>
        <input id="subject" name="subject" style="display: block" type="text">
      </div>
      <div style="display: inline-block">
        <label for="predicate">Predicate</label>
        <input id="predicate" name="predicate" style="display: block" type="text">
      </div>
      <div style="display: inline-block">
        <label for="object">Object</label>
        <input id="object" name="object" style="display: block" type="text">
      </div>
      <input type="submit" style="display: block" value="send" id="button">
    </form>
    <script>
      {
        const socket = new WebSocket('ws://localhost:4000/ws/chat')

        const setupSocket = () => {
          socket.addEventListener('message', (event) => {
            const pTag = document.createElement('p')
            pTag.innerHTML = event.data

            document.getElementById('main').append(pTag)
          })

          socket.addEventListener('close', setupSocket)
        }

        const submit = (event) => {
          event.preventDefault()
          socket.send(JSON.stringify([
            document.getElementById('subject').value,
            document.getElementById('predicate').value,
            document.getElementById('object').value,
          ]))
        }

        document.getElementById('button').addEventListener(
          'click',
          (event) => submit(event),
        )
        setupSocket()
      }
    </script>
  </body>
</html>
